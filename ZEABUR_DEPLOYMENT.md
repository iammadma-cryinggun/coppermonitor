# Zeabur 部署指南 - 多品种期货监控系统

**服务名称：** 期货多品种监控
**部署平台：** Zeabur
**最后更新：** 2026-02-04

---

## 一、部署架构

### 服务类型
**Background Worker（后台工作服务）**
- 持续运行，不对外暴露端口
- 每4小时自动执行监控任务
- 通过Telegram推送通知

### 资源需求
- **CPU：** 0.5 vCPU（最小）
- **内存：** 512MB（最小）
- **存储：** 1GB（用于日志文件）
- **网络：** 标准网络访问（获取AkShare数据）

---

## 二、部署步骤

### 步骤1：准备代码仓库

确保代码仓库包含以下文件：

```
你的仓库/
├── china_futures_fetcher.py    # 数据获取模块
├── notifier.py                 # Telegram通知模块
├── futures_monitor.py          # 主程序（必选）
├── requirements.txt            # Python依赖
├── Dockerfile                  # 容器配置（必选）
└── .dockerignore              # 排除文件（推荐）
```

### 步骤2：在Zeabur创建服务

1. 登录 [Zeabur](https://zeabur.com)
2. 创建新项目或选择现有项目
3. 点击"Create Service"
4. 选择"Git" -> 选择你的代码仓库
5. Zeabur会自动检测到Dockerfile并使用Docker部署

### 步骤3：配置环境变量

在Zeabur控制台添加以下环境变量：

| 变量名 | 说明 | 示例值 | 必填 |
|--------|------|--------|------|
| `TELEGRAM_BOT_TOKEN` | Telegram Bot Token | `123456789:ABCdefGHI...` | 推荐 |
| `TELEGRAM_CHAT_ID` | Telegram Chat ID | `123456789` | 推荐 |

**如何获取Telegram配置：**
1. 向 @BotFather 发送 `/newbot` 创建Bot，获取Token
2. 向你的Bot发送消息，然后访问 `https://api.telegram.org/bot<TOKEN>/getUpdates` 获取Chat ID

### 步骤4：配置持久化存储

**重要：** logs目录需要持久化，否则重启后数据会丢失！

在Zeabur中添加卷挂载：
- **挂载路径：** `/app/logs`
- **类型：** Volume（持久化卷）

Zeabur配置方式：
1. 进入服务设置
2. 找到"Volumes"或"存储"部分
3. 添加卷：`/app/logs`

### 步骤5：启动服务

1. 点击"Deploy"开始部署
2. 等待镜像构建完成（约2-5分钟）
3. 服务自动启动，开始定时监控

---

## 三、验证部署

### 检查服务状态

在Zeabur控制台：
1. 查看服务状态：应该显示"Running"
2. 查看日志：应该看到监控输出
3. 检查健康检查：应该显示"Healthy"

### 查看日志输出

正常情况下，日志应该显示：

```
===============================================================================
期货多品种策略监控系统（TOP 10优质信号）
运行时间: 2026-02-04 XX:XX:XX
===============================================================================
...
[PTA] 数据源: API | 数据量: 512条
...
================================================================================
监控汇总
================================================================================
监控品种: 10个
当前持仓: 0个 - 无
追踪记录已保存: /app/logs/multi_tracking.csv
```

### 验证数据持久化

1. 在Zeabur控制台，进入服务的终端
2. 执行：`ls -la /app/logs`
3. 应该看到：
   - `multi_positions.json`
   - `multi_signals.json`
   - `multi_tracking.csv`
   - `multi_monitor.log`

---

## 四、运行时间表

服务启动后会按照以下时间表自动运行：

| 运行时间 | 说明 |
|---------|------|
| 启动时 | 立即执行一次 |
| 0:00 UTC | 每4小时 |
| 4:00 UTC | 每4小时 |
| 8:00 UTC | 每4小时 |
| 12:00 UTC | 每4小时 |
| 16:00 UTC | 每4小时 |
| 20:00 UTC | 每4小时 |

**注意：** 容器使用UTC时区，但程序内部已设置为Asia/Shanghai时区。

---

## 五、监控品种

系统会同时监控以下10个品种：

1. **PTA** - 郑商所（质量评分: 83.8分）
2. **沪镍** - 上期所（质量评分: 81.0分）
3. **棕榈油** - 大商所（质量评分: 80.0分）
4. **纯碱** - 郑商所（质量评分: 78.6分）
5. **PVC** - 大商所（质量评分: 78.3分）
6. **沪铜** - 上期所（质量评分: 77.0分）
7. **豆粕** - 大商所（质量评分: 76.7分）
8. **沪锡** - 上期所（质量评分: 76.2分）
9. **沪铅** - 上期所（质量评分: 73.3分）
10. **玻璃** - 郑商所（质量评分: 71.9分）

---

## 六、故障排查

### 问题1：服务无法启动

**可能原因：**
- Dockerfile构建失败
- Python依赖安装失败

**解决方案：**
1. 检查构建日志
2. 确保requirements.txt正确
3. 尝试增加内存限制

### 问题2：健康检查失败

**可能原因：**
- 首次运行尚未完成
- logs目录权限问题

**解决方案：**
1. 等待1-2分钟后查看状态
2. 确保logs目录权限为777（Dockerfile中已设置）

### 问题3：无法获取数据

**可能原因：**
- 网络访问限制
- AkShare API问题

**解决方案：**
1. 检查服务网络连接
2. 查看日志中的数据源信息
3. API失败时会自动使用CSV备用数据

### 问题4：Telegram通知不发送

**可能原因：**
- 环境变量未设置
- Token或Chat ID错误
- 网络问题

**解决方案：**
1. 检查环境变量配置
2. 验证Token和Chat ID格式
3. 查看日志中的错误信息

---

## 七、成本估算

### Zeabur费用（按月）

| 配置 | CPU | 内存 | 存储 | 预估费用 |
|------|-----|------|------|---------|
| 最小配置 | 0.5 vCPU | 512MB | 1GB | $5-10/月 |
| 推荐配置 | 1 vCPU | 1GB | 2GB | $10-20/月 |

**注意：** 实际费用取决于Zeabur的定价策略和你的使用量。

---

## 八、监控和维护

### 查看实时日志

在Zeabur控制台：
1. 进入服务详情
2. 点击"Logs"标签
3. 实时查看服务输出

### 下载日志文件

1. 进入服务终端
2. 执行：`cat /app/logs/multi_tracking.csv`
3. 或使用Zeabur的文件下载功能（如果支持）

### 重启服务

在Zeabur控制台：
1. 进入服务详情
2. 点击"Restart"按钮

### 更新代码

1. 推送新代码到Git仓库
2. 在Zeabur点击"Redeploy"
3. 等待新版本部署完成

---

## 九、安全建议

1. **环境变量安全**
   - 不要在代码中硬编码Token
   - 使用Zeabur的环境变量功能
   - 定期更换Telegram Token

2. **访问控制**
   - Zeabur项目设置为私有
   - 限制仓库访问权限

3. **数据备份**
   - 定期备份logs目录
   - 导出重要交易记录

---

## 十、优化建议

### 性能优化

1. **调整运行频率**
   - 修改`futures_monitor.py`中的`RUN_INTERVAL_HOURS`
   - 重建镜像并重新部署

2. **增加监控品种**
   - 编辑`TOP10_FUTURES_CONFIG`字典
   - 重新部署

### 成本优化

1. **使用更小的实例**
   - 如果资源占用低，可以降配

2. **合并服务**
   - 如果有其他后台任务，可以考虑合并

---

## 十一、常见问题

### Q1: 数据源是什么？

**A:** 优先使用AkShare API（实时数据），API失败时使用本地CSV文件。

### Q2: 如何确认服务在运行？

**A:** 查看Zeabur控制台的服务状态和日志，或等待Telegram通知。

### Q3: 可以更改监控时间吗？

**A:** 可以，修改`RUN_INTERVAL_HOURS`变量后重新部署。

### Q4: 支持添加新品种吗？

**A:** 支持，编辑`TOP10_FUTURES_CONFIG`配置后重新部署。

### Q5: 数据会持久化吗？

**A:** 会，logs目录已配置为持久化存储。

---

## 十二、部署检查清单

部署前确认：

- [ ] 代码已推送到Git仓库
- [ ] Dockerfile存在且正确
- [ ] requirements.txt包含所有依赖
- [ ] .dockerignore已配置
- [ ] 环境变量已准备好

部署后确认：

- [ ] 服务状态为Running
- [ ] 健康检查为Healthy
- [ ] 日志输出正常
- [ ] Telegram通知正常（如已配置）
- [ ] 数据持久化已配置

---

**部署指南版本：** v1.0
**最后更新：** 2026-02-04
**维护者：** Claude Code
