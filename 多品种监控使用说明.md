# 期货多品种监控系统 - 使用说明

**文件路径：** `D:\期货数据\铜期货监控\futures_monitor.py`
**最后更新：** 2026-02-04

---

## 一、系统概述

### 监控品种（TOP 10 优质信号）

| 排名 | 品种 | 质量评分 | 胜率 | 盈亏比 | 交易所 |
|------|------|---------|------|--------|--------|
| 1 | **PTA** | 83.8分 | 84.6% | 11.08 | 郑商所 |
| 2 | **沪镍** | 81.0分 | 60.0% | 19.35 | 上期所 |
| 3 | **棕榈油** | 80.0分 | 75.0% | 3.06 | 大商所 |
| 4 | **纯碱** | 78.6分 | 71.4% | 5.26 | 郑商所 |
| 5 | **PVC** | 78.3分 | 83.3% | 6.74 | 大商所 |
| 6 | **沪铜** | 77.0分 | 75.0% | 8.49 | 上期所 |
| 7 | **豆粕** | 76.7分 | 66.7% | 3.59 | 大商所 |
| 8 | **沪锡** | 76.2分 | 55.6% | 6.19 | 上期所 |
| 9 | **沪铅** | 73.3分 | 83.3% | 2.55 | 上期所 |
| 10 | **玻璃** | 71.9分 | 57.1% | 2.40 | 郑商所 |

### 核心功能

✅ **独立参数管理** - 每个品种使用自己的最优参数
✅ **独立持仓跟踪** - 每个品种独立记录开仓/平仓状态
✅ **自动信号推送** - Telegram实时推送交易信号
✅ **定时运行** - 每4小时自动运行（0:00, 4:00, 8:00, 12:00, 16:00, 20:00）
✅ **完整日志记录** - 记录所有信号、交易、持仓变化
✅ **不记录金额** - 只跟踪持仓状态，不涉及具体资金

---

## 二、快速开始

### 方法1：使用启动脚本（推荐）

双击运行 `启动监控.bat`，然后选择：
1. **单次运行** - 立即执行一次监控
2. **定时运行** - 每4小时自动运行
3. **退出**

### 方法2：命令行运行

```bash
# 单次运行
python futures_monitor.py

# 定时运行
python futures_monitor.py --scheduled
```

---

## 三、运行模式

### 模式1：单次运行

**用途：** 立即执行一次监控，适合手动检查

**输出：**
- 控制台显示每个品种的详细状态
- 生成追踪记录 CSV 文件
- 发送 Telegram 推送（如已配置）

**示例：**
```bash
python futures_monitor.py
```

---

### 模式2：定时运行

**用途：** 每4小时自动运行，长期监控

**运行时间点：**
- 00:00
- 04:00
- 08:00
- 12:00
- 16:00
- 20:00

**行为：**
1. 启动时立即运行一次
2. 计算到下一个整点的等待时间
3. 到达整点自动运行
4. 按Ctrl+C停止监控

**示例：**
```bash
python futures_monitor.py --scheduled
```

---

## 四、输出文件

### 1. 持仓状态文件
**文件：** `logs/multi_positions.json`

**内容：** 记录所有10个品种的当前持仓状态

```json
{
  "PTA": {
    "holding": false,
    "entry_price": null,
    "entry_datetime": null,
    "stop_loss": null,
    "signal_id": null
  },
  "沪镍": {
    "holding": true,
    "entry_price": 125000.0,
    "entry_datetime": "2026-02-04 08:00:00",
    "stop_loss": 122500.0,
    "signal_id": "2026-02-04 08:00:00_sniper"
  }
}
```

**字段说明：**
- `holding`: 是否持有仓位
- `entry_price`: 开仓价格
- `entry_datetime`: 开仓时间
- `stop_loss`: 止损价格
- `signal_id`: 信号唯一标识

---

### 2. 交易日志文件
**文件：** `logs/multi_signals.json`

**内容：** 记录所有开仓/平仓操作

```json
[
  {
    "timestamp": "2026-02-04T08:00:00",
    "future": "沪镍",
    "action": "buy",
    "signal_datetime": "2026-02-04 08:00:00",
    "price": 125000.0,
    "signal_type": "sniper",
    "pnl_pct": null,
    "stop_loss": 122500.0,
    "indicators": {...}
  },
  {
    "timestamp": "2026-02-04T16:00:00",
    "future": "沪镍",
    "action": "sell",
    "signal_datetime": "2026-02-04 16:00:00",
    "price": 128000.0,
    "signal_type": "stc",
    "pnl_pct": 2.4,
    "stop_loss": null,
    "indicators": {...}
  }
]
```

---

### 3. 追踪记录文件
**文件：** `logs/multi_tracking.csv`

**内容：** 每次运行的汇总记录

| 字段 | 说明 |
|------|------|
| timestamp | 运行时间戳 |
| datetime | 运行时间（可读） |
| monitored_count | 监控品种数 |
| buy_signals | 买入信号品种（逗号分隔） |
| sell_signals | 卖出信号品种（逗号分隔） |
| active_positions | 当前持仓品种（逗号分隔） |
| PTA_price | PTA价格 |
| PTA_trend | PTA趋势 |
| PTA_buy | PTA买入信号（true/false） |
| ... | 其他品种类似字段 |

---

### 4. 运行日志文件
**文件：** `logs/multi_monitor.log`

**内容：** 详细的运行日志，便于调试和问题排查

---

## 五、Telegram 通知

### 推送内容

每次运行后会发送包含以下内容的报告：

1. **监控汇总**
   - 监控品种数
   - 当前持仓品种列表

2. **交易信号**
   - 买入信号品种及信号类型
   - 卖出信号品种及信号类型

3. **各品种状态**
   - 持仓品种：显示当前盈亏百分比
   - 买入信号：标注 🟢 和信号类型
   - 卖出信号：标注 🔴 和信号类型
   - 观望品种：显示趋势和强度

### 推送示例

```
📊 期货多品种监控报告
🕐 时间: 2026-02-04 08:00

📈 监控品种: 10个
💼 当前持仓: 2个
   持仓: 沪镍, PTA

🟢 买入信号 (1个):
   • 棕榈油: sniper @ 5200.00

📋 各品种状态:
   PTA: 📌 持仓 | 盈亏+2.1%
   沪镍: 📌 持仓 | 盈亏-0.8%
   棕榈油: 🟢 sniper
   纯碱: 📈 normal
   PVC: 📉 weak
   沪铜: 📈 strong
   豆粕: 📉 normal
   沪锡: 📈 normal
   沪铅: 📉 weak
   玻璃: 📈 strong
```

---

## 六、持仓管理

### 自动开仓

当出现买入信号时，系统会：
1. 记录开仓信息（价格、时间、信号类型）
2. 设置止损价格
3. 更新持仓状态文件
4. 记录到交易日志
5. 发送 Telegram 通知

### 自动平仓

当出现以下任一情况时，系统会自动记录平仓信号：
1. **STC止盈** - STC从高位回落
2. **趋势反转** - EMA快线下穿慢线
3. **止损触发** - 价格触及止损价

**重要：** 系统只记录信号，**不执行实际交易**。需要人工确认后执行。

### 当前盈亏计算

对于每个持仓品种，系统会实时计算：
```
盈亏% = (当前价格 - 开仓价格) / 开仓价格 × 100%
```

并在日志和Telegram推送中显示。

---

## 七、信号类型说明

### 狙击信号（Sniper）

**触发条件（5个同时满足）：**
- 趋势向上：`ema_fast > ema_slow`
- Ratio安全：`0 < ratio < RATIO_TRIGGER`
- Ratio收缩：`ratio < 上一根ratio`
- 转头向上：`macd_dif > 上一根macd_dif`
- 强势确认：`rsi > RSI_FILTER`

**特点：** 在趋势确认、动能蓄积时提前介入，盈亏比通常更好

---

### 追涨信号（Chase）

**触发条件（2个同时满足）：**
- EMA金叉：`上一根ema_fast <= 上一根ema_slow AND 当前ema_fast > 当前ema_slow`
- 强势确认：`rsi > RSI_FILTER`

**特点：** 趋势已经启动，交易机会更多，但盈亏比可能略低

---

### 卖出信号

**STC止盈：** STC从高位回落（避免过山车）
**趋势反转：** EMA快线下穿慢线（趋势结束）
**止损：** 价格触及止损价（风险控制）

---

## 八、参数配置

每个品种使用独立的最优参数，配置在 `futures_monitor.py` 的 `TOP10_FUTURES_CONFIG` 字典中。

### 参数说明

```python
'PTA': {
    'name': 'PTA',                    # 品种名称
    'code': 'TA',                     # 交易所代码
    'exchange': 'CZCE',               # 交易所
    'quality_score': 83.8,            # 信号质量评分
    'params': {
        'EMA_FAST': 12,               # 快速EMA周期
        'EMA_SLOW': 10,               # 慢速EMA周期
        'RSI_FILTER': 40,             # RSI过滤值
        'RATIO_TRIGGER': 1.25,        # Ratio触发阈值
        'STC_SELL_ZONE': 75,          # STC卖出区域
        'STOP_LOSS_PCT': 0.02         # 止损百分比（2%）
    },
    'contract_size': 5,               # 合约单位（吨/手）
    'margin_rate': 0.07               # 保证金比例（7%）
}
```

### 修改参数

如需调整参数，编辑 `futures_monitor.py` 文件中的 `TOP10_FUTURES_CONFIG` 字典。

**注意：** 修改参数后需重启监控程序。

---

## 九、常见问题

### Q1: 如何添加新品种？

**A:** 编辑 `TOP10_FUTURES_CONFIG` 字典，添加新品种配置：

```python
'新品种名称': {
    'name': '新品种名称',
    'code': '交易所代码',
    'exchange': '交易所',
    'quality_score': 评分,
    'params': {...},
    'contract_size': 合约单位,
    'margin_rate': 保证金比例
}
```

---

### Q2: 如何调整运行间隔？

**A:** 修改 `futures_monitor.py` 中的配置：

```python
RUN_INTERVAL_HOURS = 4  # 改为其他值（如2、6、8等）
```

**注意：** 建议保持4小时，与数据周期一致。

---

### Q3: 如何禁用某个品种？

**A:** 在 `TOP10_FUTURES_CONFIG` 字典中注释掉该品种：

```python
# 'PTA': {
#     ...
# }
```

---

### Q4: 数据源是什么？

**A:**
1. **主数据源：** AkShare API（实时数据）
2. **备用数据源：** `data/` 目录下的CSV文件

**优先级：** API > CSV

---

### Q5: 如何查看历史记录？

**A:** 查看以下文件：
- 交易记录：`logs/multi_signals.json`
- 运行记录：`logs/multi_tracking.csv`
- 运行日志：`logs/multi_monitor.log`

---

### Q6: 系统会自动交易吗？

**A:** **不会！** 系统只负责：
1. 监控市场数据
2. 生成交易信号
3. 记录持仓状态
4. 发送通知提醒

**实际交易需要人工确认和执行。**

---

### Q7: 如何停止定时运行？

**A:** 在命令行窗口按 `Ctrl + C`

---

## 十、建议运行方式

### 开发/测试阶段
```bash
# 使用单次运行，手动检查
python futures_monitor.py
```

### 实盘监控阶段
```bash
# 使用定时运行，24小时不间断
python futures_monitor.py --scheduled
```

**推荐：** 使用 Windows 任务计划程序或 Linux cron 设置开机自启动。

---

## 十一、系统要求

### Python 环境
- Python 3.7+
- pandas
- numpy
- AkShare（数据获取）

### 第三方模块
```bash
pip install pandas numpy akshare
```

### 依赖文件
- `china_futures_fetcher.py` - 数据获取模块
- `notifier.py` - Telegram 通知模块（可选）

---

## 十二、注意事项

⚠️ **重要提醒**

1. **系统仅供参考，不构成投资建议**
2. **回测收益不等于实盘收益**
3. **期货交易风险巨大，可能损失全部本金**
4. **所有交易需要人工确认后执行**
5. **建议先用小资金测试信号质量**
6. **严格遵守止损纪律**

---

## 十三、文件清单

```
D:\期货数据\铜期货监控\
├── futures_monitor.py              # 主程序
├── 启动监控.bat                     # 启动脚本
├── 多品种监控使用说明.md             # 本文件
│
├── china_futures_fetcher.py         # 数据获取模块
├── notifier.py                      # 通知模块
│
└── logs/
    ├── multi_positions.json         # 持仓状态
    ├── multi_signals.json           # 交易日志
    ├── multi_tracking.csv           # 运行记录
    └── multi_monitor.log            # 运行日志
```

---

**使用说明版本：** v1.0
**最后更新：** 2026-02-04
**维护者：** Claude Code
