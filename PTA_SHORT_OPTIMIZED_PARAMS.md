# PTA做空优化参数记录

**优化时间：** 2026-02-04
**品种：** PTA (TA)
**交易所：** 郑商所 (CZCE)

---

## 📊 最优参数

### 做空参数

| 参数 | 最优值 | 说明 |
|------|--------|------|
| **EMA_FAST** | **7** | 快速EMA周期 |
| **EMA_SLOW** | **20** | 慢速EMA周期 |
| **RSI_FILTER** | **45** | RSI弱势阈值（做空：RSI < 45） |
| **RATIO_TRIGGER** | **1.05** | Ratio触发阈值 |
| **STC_BUY_ZONE** | **15** | STC买入区（平空仓信号） |

---

## 📈 回测结果

### 收益表现

| 指标 | 数值 |
|------|------|
| **总收益率** | **+61.44%** |
| **交易次数** | **5笔** |
| **胜率** | **100.0%** |
| **初始资金** | 50,000元 |
| **最终资金** | 80,720元 |
| **总盈亏** | +30,720元 |

### 回测条件

- **数据周期：** 2025-05-28 至 2026-02-04（约8个月）
- **K线数量：** 512条（4小时K线）
- **合约规格：** 5吨/手
- **保证金率：** 8%
- **止损幅度：** 2%
- **资金管理：** 完整动态仓位管理

---

## 🎯 参数说明

### 1. EMA参数（7, 20）

```python
EMA_FAST = 7    # 快线：7周期
EMA_SLOW = 20   # 慢线：20周期
```

**信号逻辑：**
- **做空狙击：** EMA_FAST < EMA_SLOW（趋势向下）
- **做空追涨：** EMA快线从上到下穿过EMA慢线（死叉）

**特点：** 较快的响应速度（7周期）和较稳定的趋势判断（20周期）

### 2. RSI_FILTER = 45

```python
RSI_FILTER = 45  # RSI弱势阈值
```

**做空条件：** RSI < 45（弱势区域）

**特点：** 比做多的RSI_FILTER=40稍高，确保在弱势区域做空

### 3. RATIO_TRIGGER = 1.05

```python
RATIO_TRIGGER = 1.05
```

**做空条件：** -1.05 < Ratio < 0（负值安全区）

**特点：** 严格的Ratio阈值，避免在强势区域做空

### 4. STC_BUY_ZONE = 15

```python
STC_BUY_ZONE = 15  # STC买入区（平空仓）
```

**平空仓信号：**
- STC从低位回升：stc_prev < 15 AND stc > stc_prev
- 趋势反转向上：EMA_FAST > EMA_SLOW

**特点：** 在超卖区（STC < 15）回升时平空仓

---

## 📊 对比分析

### 与做多参数对比

| 参数 | 做多值 | 做空值 | 差异 |
|------|--------|--------|------|
| EMA_FAST | 12 | **7** | 做空更快 |
| EMA_SLOW | 10 | **20** | 做空更稳 |
| RSI_FILTER | 40 | **45** | 做空阈值更高 |
| RATIO_TRIGGER | 1.25 | **1.05** | 做空更严格 |
| STC_ZONE | 75（卖区） | **15（买区）** | 方向相反 |

**关键发现：**
- 做空使用**更快的EMA**（7 vs 12）：快速捕捉下跌趋势
- 做空使用**更长的慢线**（20 vs 10）：确保趋势稳定性
- 做空RSI阈值**更高**（45 vs 40）：只在明显弱势时做空
- 做空RATIO阈值**更严格**（1.05 vs 1.25）：避免误判

### 回测结果对比

| 策略 | 收益率 | 交易次数 | 胜率 |
|------|--------|----------|------|
| **只做多** | +167.47% | 13笔 | 84.6% |
| **只做空（优化参数）** | **+61.44%** | **5笔** | **100.0%** |
| **做空优先双向** | +100.94% | 10笔 | 80.0% |
| **做多优先双向** | +86.18% | 8笔 | 75.0% |

**结论：**
- 做空虽然交易次数少，但**胜率极高**（100%）
- 优化后的做空参数**收益率优秀**（+61.44%）
- 做空信号**质量更高**，更严格

---

## 🔄 信号逻辑

### 做空开仓信号

```python
# 1. 做空狙击信号（所有条件必须满足）
trend_down = ema_fast < ema_slow              # 趋势向下
ratio_safe = -1.05 < ratio < 0                 # Ratio负值安全区
ratio_falling = ratio < prev_ratio             # Ratio变得更负
turning_down = macd_dif < prev_macd_dif        # MACD下降
is_weak = rsi < 45                             # RSI弱势

sniper_short = trend_down AND ratio_safe AND ratio_falling AND turning_down AND is_weak

# 2. 做空追涨信号（死叉+弱势）
ema_death_cross = (prev_ema_fast >= prev_ema_slow) AND (ema_fast < ema_slow)
chase_short = ema_death_cross AND is_weak

# 最终做空信号
short_signal = sniper_short OR chase_short
```

### 做空平仓信号

```python
# 1. STC低位回升（止盈）
stc_exit = (stc_prev < 15) AND (stc > stc_prev)

# 2. 趋势反转向上
trend_exit = ema_fast > ema_slow

# 平空仓信号
cover_short_signal = stc_exit OR trend_exit
```

### 做空止损

```python
# 开仓时设置止损
stop_loss = entry_price × (1 + 0.02)  # 止损在上方2%

# 检查止损（每根K线）
if high >= stop_loss:
    # 触发止损，立即平空仓
```

---

## 📁 相关文件

**优化脚本：**
- `optimize_pta_short_only.py` - PTA做空参数优化脚本

**回测脚本：**
- `backtest_pta_short_priority.py` - 做空优先双向回测
- `analyze_hedging_corrected.py` - 对冲策略回测（完整版）

**数据文件：**
- `logs/pta_short_optimization.json` - 优化结果JSON
- `logs/pta_short_trades.csv` - 交易记录CSV

---

## ⚠️ 使用建议

### 1. 适用场景

**适合做空的情况：**
- ✅ 明确下跌趋势（EMA_FAST < EMA_SLOW）
- ✅ Ratio进入负值区（-1.05 < Ratio < 0）
- ✅ RSI进入弱势区（RSI < 45）
- ✅ MACD转头向下

**不适合做空的情况：**
- ❌ 趋势向上或横盘
- ❌ Ratio为正值（强势区）
- ❌ RSI在强势区（> 50）
- ❌ 市场处于震荡期

### 2. 风险提示

1. **回测数据有限：** 仅8个月数据，需要更长期验证
2. **交易次数少：** 5笔交易样本量较小
3. **数据窥探风险：** 优化和验证使用同一时间段
4. **市场环境变化：** 未来市场可能不同于历史

### 3. 优化方向

**建议进一步优化：**
1. ✅ Walk-Forward滚动验证
2. ✅ OOS样本外测试
3. ✅ 参数扰动鲁棒性测试
4. ✅ 更长历史数据回测（2-3年）

---

## 📌 总结

### 优化结论

✅ **PTA做空策略可行**
- 收益率：+61.44%
- 胜率：100.0%
- 风险：可控（2%止损）

✅ **参数优化成功**
- EMA(7, 20)：快速响应+稳定判断
- RSI=45：明确的弱势阈值
- RATIO=1.05：严格的触发条件
- STC=15：超卖区止盈

✅ **与做多策略互补**
- 做多：+167.47%（13笔，84.6%胜率）
- 做空：+61.44%（5笔，100%胜率）
- 综合：可以实现双向交易，提高资金利用率

---

**记录时间：** 2026-02-04
**优化方法：** 网格搜索（3125种参数组合）
**验证状态：** 待进行Walk-Forward和OOS测试
