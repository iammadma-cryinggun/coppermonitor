@echo off
REM ====================================================================
REM 创建Windows定时任务
REM ====================================================================
REM
REM 此脚本会创建一个Windows任务计划程序任务
REM 每4小时运行一次监控脚本
REM
REM 运行此脚本需要管理员权限
REM
REM ====================================================================

echo.
echo ====================================================================
echo 沪铜策略 - 创建Windows定时任务
echo ====================================================================
echo.

REM 检查管理员权限
net session >nul 2>&1
if %errorLevel% neq 0 (
    echo [错误] 此脚本需要管理员权限
    echo 请右键点击此脚本，选择"以管理员身份运行"
    echo.
    pause
    exit /b 1
)

REM 删除旧任务（如果存在）
echo [1/4] 删除旧任务（如果存在）...
schtasks /Delete /TN "沪铜监控" /F >nul 2>&1

REM 创建新任务
echo [2/4] 创建新任务...
schtasks /Create /TN "沪铜监控" /TR "D:\期货数据\铜期货监控\run_monitor.bat" /SC HOURLY /MO 4 /RU SYSTEM /F

if %errorLevel% neq 0 (
    echo [错误] 任务创建失败
    echo.
    pause
    exit /b 1
)

REM 设置任务详细说明
echo [3/4] 设置任务说明...
schtasks /Change /TN "沪铜监控" /RU SYSTEM /RL HIGHEST

echo [4/4] 查看任务信息...
echo.
echo ====================================================================
echo 任务已创建成功！
echo ====================================================================
echo.
schtasks /Query /TN "沪铜监控" /FO LIST /V

echo.
echo ====================================================================
echo 下次运行时间:
echo ====================================================================
for /f "tokens=*" %%i in ('schtasks /Query /TN "沪铜监控" /FO LIST ^| find "Next Run Time"') do echo %%i

echo.
echo ====================================================================
echo 使用说明:
echo ====================================================================
echo.
echo 1. 监控脚本将每4小时自动运行一次
echo 2. 日志保存在: D:\期货数据\铜期货监控\logs\
echo 3. 如需手动运行，双击 run_monitor.bat
echo 4. 如需查看任务，打开"任务计划程序"（搜索"taskschd.msc"）
echo 5. 如需删除任务，运行: schtasks /Delete /TN "沪铜监控" /F
echo.

pause
