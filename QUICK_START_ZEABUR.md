# Zeabur 快速部署指南

## ✅ 已完成的优化

### 1. 容器化优化
- ✅ Dockerfile已更新（支持Python 3.11）
- ✅ .dockerignore已创建（排除不必要的文件）
- ✅ requirements.txt已确认（包含所有依赖）
- ✅ 健康检查已配置（每10分钟检查一次）

### 2. 代码优化
- ✅ 信号处理（SIGTERM/SIGINT）- 支持优雅退出
- ✅ 分段等待（每60秒检查退出信号）
- ✅ 异常处理（自动重试机制）
- ✅ 日志输出（标准输出+文件）

### 3. 数据源确认
- ✅ 使用AkShare API（实时数据）- 与铜监控相同
- ✅ CSV备用数据（API失败时自动切换）

---

## 🚀 Zeabur部署步骤

### 步骤1：准备Git仓库

确保以下文件已提交到Git仓库：

```
必需文件：
✅ china_futures_fetcher.py
✅ notifier.py
✅ futures_monitor.py
✅ requirements.txt
✅ Dockerfile
✅ .dockerignore

可选文件：
📄 ZEABUR_DEPLOYMENT.md（详细部署指南）
📄 多品种监控使用说明.md
```

### 步骤2：在Zeabur创建服务

1. 登录 https://zeabur.com
2. 创建新项目
3. 点击"Create Service" → "Git"
4. 选择你的代码仓库
5. Zeabur自动检测Dockerfile并开始构建

### 步骤3：配置环境变量（可选）

在Zeabur服务设置中添加：

```
TELEGRAM_BOT_TOKEN=你的Bot_Token
TELEGRAM_CHAT_ID=你的Chat_ID
```

**注意：** 如果不配置Telegram，服务仍然正常运行，只是不会发送通知。

### 步骤4：配置持久化存储（重要！）

添加卷挂载：
- **路径：** `/app/logs`
- **类型：** Volume

这确保重启后交易记录不会丢失。

### 步骤5：启动并验证

1. 点击"Deploy"开始部署
2. 等待2-5分钟构建完成
3. 查看日志确认服务正常运行

---

## 📊 验证部署成功

### 查看日志

在Zeabur控制台应该看到：

```
================================================================================
期货多品种策略监控系统（TOP 10优质信号）
启动时间: 2026-02-04 XX:XX:XX
运行间隔: 每4小时 (0:00, 4:00, 8:00, 12:00, 16:00, 20:00)
已注册信号处理器，支持优雅退出
================================================================================

开始执行监控...
============================================================
[PTA] 质量评分: 83.8分
[PTA] 参数: EMA(12,10), RSI=40, RATIO=1.25, STC=75
...
[PTA] 数据源: API | 数据量: 512条
...
```

### 检查服务状态

- 服务状态：✅ Running
- 健康检查：✅ Healthy
- CPU使用：正常（< 10%）
- 内存使用：正常（< 200MB）

---

## 📋 监控的品种

| # | 品种 | 交易所 | 质量评分 | 胜率 |
|---|------|--------|---------|------|
| 1 | PTA | 郑商所 | 83.8分 | 84.6% |
| 2 | 沪镍 | 上期所 | 81.0分 | 60.0% |
| 3 | 棕榈油 | 大商所 | 80.0分 | 75.0% |
| 4 | 纯碱 | 郑商所 | 78.6分 | 71.4% |
| 5 | PVC | 大商所 | 78.3分 | 83.3% |
| 6 | 沪铜 | 上期所 | 77.0分 | 75.0% |
| 7 | 豆粕 | 大商所 | 76.7分 | 66.7% |
| 8 | 沪锡 | 上期所 | 76.2分 | 55.6% |
| 9 | 沪铅 | 上期所 | 73.3分 | 83.3% |
| 10 | 玻璃 | 郑商所 | 71.9分 | 57.1% |

---

## ⏰ 运行时间表

服务启动后自动按照以下时间运行：

- **启动时**：立即执行一次
- **每4小时**：00:00, 04:00, 08:00, 12:00, 16:00, 20:00

---

## 📁 生成的文件

所有文件保存在 `/app/logs` 目录（持久化）：

| 文件 | 说明 |
|------|------|
| `multi_positions.json` | 持仓状态 |
| `multi_signals.json` | 交易记录 |
| `multi_tracking.csv` | 运行记录 |
| `multi_monitor.log` | 详细日志 |

---

## 🔧 常见问题

### Q: 数据源是什么？
**A:** 使用AkShare API（实时数据），与现在的铜监控程序完全相同。

### Q: 如何查看日志？
**A:** 在Zeabur控制台的"Logs"标签页查看实时日志。

### Q: 如何下载交易记录？
**A:** 在服务终端执行 `cat /app/logs/multi_tracking.csv` 或使用Zeabur的文件下载功能。

### Q: 服务会自动重启吗？
**A:** Zeabur会监控服务，崩溃时自动重启。我们的代码也支持优雅退出。

### Q: 如何停止服务？
**A:** 在Zeabur控制台点击"Stop"按钮。

### Q: 如何更新代码？
**A:** 推送新代码到Git，然后点击"Redeploy"按钮。

---

## ⚠️ 重要提醒

1. **数据持久化** - 必须配置 `/app/logs` 卷挂载，否则重启后数据丢失
2. **环境变量** - Telegram配置是可选的，不影响服务运行
3. **资源限制** - 建议至少512MB内存
4. **网络访问** - 确保服务可以访问互联网（获取AkShare数据）
5. **时区** - 容器使用UTC时区，但程序内部已设置为Asia/Shanghai

---

## 💰 成本估算

| 配置 | 预估月费 |
|------|---------|
| 最小（0.5 vCPU, 512MB） | $5-10/月 |
| 推荐（1 vCPU, 1GB） | $10-20/月 |

**实际费用取决于Zeabur定价策略。**

---

## 📞 支持

如遇到问题：
1. 查看日志排查错误
2. 参考 `ZEABUR_DEPLOYMENT.md` 详细文档
3. 检查服务终端的状态

---

**最后更新：** 2026-02-04
**状态：** ✅ 已测试，可以部署
